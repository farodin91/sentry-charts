apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ template "sentry.fullname" . }}-snuba-api
  labels:
    app: sentry
    chart: "{{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
{{- define "snuba.api.container" -}}
{{- if .Values.snuba.api.command }}
command:
{{ toYaml .Values.snuba.api.command | indent 2 }}
{{- end }}
livenessProbe:
  failureThreshold: 5
  httpGet:
    path: /
    port: {{ template "snuba.port" }}
    scheme: HTTP
  initialDelaySeconds: {{ .Values.snuba.api.probeInitialDelaySeconds }}
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: {{ .Values.snuba.api.liveness.timeoutSeconds }}
readinessProbe:
  failureThreshold: 10
  httpGet:
    path: /
    port: {{ template "snuba.port" }}
    scheme: HTTP
  initialDelaySeconds: {{ .Values.snuba.api.probeInitialDelaySeconds }}
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: {{ .Values.snuba.api.readiness.timeoutSeconds }}
{{- end -}}
{{- $container := include "snuba.api.container" . }}
{{- include "snuba.spec" (list . .Values.snuba.api "api" $container) }}